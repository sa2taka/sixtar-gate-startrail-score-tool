# é–‹ç™ºçŠ¶æ³è©³ç´° - 2025-06-22

## ğŸ”§ ç¾åœ¨ã®å®Ÿè£…çŠ¶æ³

### âœ… å®Œæˆã—ã¦ã„ã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

#### 1. EditResult ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ (`web/src/components/edit-result/edit-result.tsx`)
- **æ©Ÿèƒ½**: ã‚¹ã‚³ã‚¢ç·¨é›†ãƒ•ã‚©ãƒ¼ãƒ 
- **ç‰¹å¾´**:
  - ãƒªã‚¶ãƒ«ãƒˆç”»é¢ãƒ¢ãƒ¼ãƒ‰ã¨é¸æ›²ç”»é¢ãƒ¢ãƒ¼ãƒ‰ã®åˆ‡ã‚Šæ›¿ãˆ
  - React Hook Form + Zodã«ã‚ˆã‚‹ãƒ•ã‚©ãƒ¼ãƒ ç®¡ç†
  - å„ç¨®åˆ¤å®šæ•°å€¤ã®å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
  - ãƒ‘ã‚¿ãƒ¼ãƒ³é¸æŠï¼ˆã‚·ãƒ¼ã‚±ãƒ³ã‚·ãƒ£ãƒ«/ãƒ©ãƒ³ãƒ€ãƒ ï¼‰
  - ãƒã‚¶ãƒ¼ãƒ‰é¸æŠï¼ˆãƒãƒ¼ãƒãƒ«/ãƒãƒ¼ãƒ‰/ãã®ä»–ï¼‰

#### 2. MusicSelect ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ (`web/src/components/edit-result/music-select.tsx`)
- **æ©Ÿèƒ½**: æ¥½æ›²é¸æŠã®ã‚ªãƒ¼ãƒˆã‚³ãƒ³ãƒ—ãƒªãƒ¼ãƒˆ
- **ç‰¹å¾´**:
  - Commandãƒ‘ã‚¿ãƒ¼ãƒ³ã«ã‚ˆã‚‹æ¤œç´¢UI
  - æ¥½æ›²åã§ã®ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
  - é¸æŠå¾Œã«é›£æ˜“åº¦æƒ…å ±ã‚’è‡ªå‹•å–å¾—
  - ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ã®æ¤œç´¢çµæœè¡¨ç¤º

#### 3. ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ (`web/src/application/result-validation.ts`)
- **å®Ÿè£…æ¸ˆã¿æ¤œè¨¼**:
  - å¿…é ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãƒã‚§ãƒƒã‚¯
  - æ•°å€¤ã®ç¯„å›²æ¤œè¨¼ï¼ˆ0ä»¥ä¸Šï¼‰
  - æ¥½æ›²ã‚³ãƒ³ãƒœæ•°ã¨ã®æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯
  - ã‚«ã‚¹ã‚¿ãƒ ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆä¸€éƒ¨æ—¥æœ¬èªåŒ–æ¸ˆã¿ï¼‰

### ğŸš§ æœªå®Ÿè£…ãƒ»èª²é¡Œ

#### 1. ãƒšãƒ¼ã‚¸ãƒ¬ãƒ™ãƒ«ã®å®Ÿè£…
- `/results/edit` ãƒšãƒ¼ã‚¸ãŒå­˜åœ¨ã—ãªã„
- score-extractorã‹ã‚‰ã®ãƒ‡ãƒ¼ã‚¿å—ã‘å–ã‚Šæ–¹æ³•ãŒæœªå®š
- ä¿å­˜å¾Œã®é·ç§»å…ˆãŒæœªå®š

#### 2. APIçµ±åˆ
- score-extractor API (`http://localhost:8080/api/v1/scores`) ã¨ã®é€£æºæœªå®Ÿè£…
- ãƒ‡ãƒ¼ã‚¿ä¿å­˜ç”¨ã®APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãŒãªã„
- èªè¨¼ã‚’è€ƒæ…®ã—ãŸãƒ‡ãƒ¼ã‚¿ä¿å­˜ãƒ•ãƒ­ãƒ¼ãŒæœªå®Ÿè£…

#### 3. UI/UXæ”¹å–„
- ç”»åƒè¡¨ç¤ºæ©Ÿèƒ½ï¼ˆå…ƒã®ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆè¡¨ç¤ºï¼‰
- ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®å®Œå…¨ãªæ—¥æœ¬èªåŒ–
- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ã®è¡¨ç¤º
- ä¿å­˜æˆåŠŸ/å¤±æ•—ã®ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯

## ğŸ“Š ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼è¨­è¨ˆï¼ˆæ¡ˆï¼‰

```mermaid
graph LR
    A[score-extractor API] -->|ãƒãƒ¼ãƒªãƒ³ã‚°| B[Next.js API Route]
    B -->|æ–°è¦ãƒ‡ãƒ¼ã‚¿| C[ç·¨é›†ãƒšãƒ¼ã‚¸]
    C -->|ãƒ¦ãƒ¼ã‚¶ãƒ¼ç·¨é›†| D[EditResult Component]
    D -->|ä¿å­˜| E[Save API]
    E -->|Prisma| F[PostgreSQL]
```

## ğŸ—„ï¸ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ§‹é€ ï¼ˆç¾çŠ¶ï¼‰

### Result ãƒ†ãƒ¼ãƒ–ãƒ«
```prisma
model Result {
  id            String   @id @default(cuid())
  userId        String
  musicId       String
  chartId       String
  playMode      PlayMode
  scoreImageUrl String?
  score         Int
  scoreRate     Float
  
  // åˆ¤å®šãƒ‡ãƒ¼ã‚¿
  justReflecBest Int
  justReflec     Int
  just           Int
  attack         Int
  miss           Int
  
  combo         Int
  hazard        HazardType
  pattern       PatternType
  resultType    ResultType
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}
```

## ğŸ” æŠ€è¡“çš„ãªæ±ºå®šäº‹é …

### ãƒ•ã‚©ãƒ¼ãƒ ç®¡ç†
- React Hook Form v7ã‚’æ¡ç”¨
- Zodã«ã‚ˆã‚‹ã‚¹ã‚­ãƒ¼ãƒãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
- ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãƒ¬ãƒ™ãƒ«ã®ã‚¨ãƒ©ãƒ¼è¡¨ç¤º

### UI ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
- shadcn/ui (Radix UI + Tailwind CSS)
- ã‚«ã‚¹ã‚¿ãƒ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯ `src/components/ui/` ã«é…ç½®
- ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰å¯¾å¿œã‚’å‰æã¨ã—ãŸè¨­è¨ˆ

### çŠ¶æ…‹ç®¡ç†
- ã‚µãƒ¼ãƒãƒ¼çŠ¶æ…‹: TanStack Query
- ãƒ•ã‚©ãƒ¼ãƒ çŠ¶æ…‹: React Hook Form
- ã‚°ãƒ­ãƒ¼ãƒãƒ«çŠ¶æ…‹: ç¾æ™‚ç‚¹ã§ã¯ä¸è¦

## ğŸ“ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã®è©³ç´°

### 1. ç·¨é›†ãƒšãƒ¼ã‚¸ã®ä½œæˆ
```typescript
// app/results/edit/page.tsx
- score-extractorã‹ã‚‰ã®ãƒ‡ãƒ¼ã‚¿å–å¾—
- EditResultã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®é…ç½®
- ä¿å­˜å‡¦ç†ã®å®Ÿè£…
```

### 2. API Routes ã®å®Ÿè£…
```typescript
// app/api/results/save/route.ts
- POSTãƒ¡ã‚½ãƒƒãƒ‰ã§ãƒ‡ãƒ¼ã‚¿å—ä¿¡
- èªè¨¼ãƒã‚§ãƒƒã‚¯
- Prismaã«ã‚ˆã‚‹ãƒ‡ãƒ¼ã‚¿ä¿å­˜
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
```

### 3. score-extractoré€£æº
```typescript
// lib/score-extractor-client.ts
- APIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ä½œæˆ
- ãƒãƒ¼ãƒªãƒ³ã‚°æ©Ÿèƒ½
- ãƒ‡ãƒ¼ã‚¿å¤‰æ›å‡¦ç†
```